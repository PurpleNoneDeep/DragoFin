{% extends 'main/layout.html' %}
{% load static %}
{% block title %}Новая транзакция{% endblock %}
{% block head %}<link rel="stylesheet" href="{% static 'main/css/addtransac.css' %}">
    <script>
        const categories = {
            'income': ['Зарплата', 'Инвестиции', 'Прочее'],
            'expense': ['Продукты', 'Транспорт', 'Развлечения']
        };

        function updateCategories() {
            const type = document.getElementById('transaction-type').value;
            const categorySelect = document.getElementById('category');

            // Очистка предыдущих опций
            categorySelect.innerHTML = '';

            // Добавление стандартных категорий
            categories[type].forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorySelect.appendChild(option);
            });

            // Добавление опции для ввода собственной категории
            const customOption = document.createElement('option');
            customOption.value = 'custom';
            customOption.textContent = 'Другая категория';
            categorySelect.appendChild(customOption);
        }

        function handleCustomCategory() {
            const categorySelect = document.getElementById('category');
            const customCategoryInput = document.getElementById('custom-category');
            if (categorySelect.value === 'custom') {
                customCategoryInput.style.display = 'block';
            } else {
                customCategoryInput.style.display = 'none';
            }
        }
    </script>{% endblock %}
{% block content %}
<header>
<div>
    <button onclick="window.location.href='{% url 'home' %}'">Вернуться на главную</button>
</div>
</header>
<main>

<div class="form-container">
    <h2>Добавить транзакцию</h2>
    <form method="POST" action="{% url 'add_transaction' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="date">Дата транзакции:</label>
            <input type="date" id="date" name="date" required>
        </div>

       <div class="form-group">
    <label for="transaction-type">Тип транзакции:</label>
    <select id="transaction-type" name="type" onchange="updateCategories()" required>
        <option value="">Выберите тип транзакции</option>
        <option value="income">Доход</option>
        <option value="expense">Расход</option>
    </select>
</div>

<div class="form-group">
    <label for="category">Категория:</label>
    <select id="category" name="category" onchange="handleCustomCategory()" required>
        <option value="">Выберите категорию</option>
    </select>
    <input type="text" id="custom-category" name="custom_category" placeholder="Введите свою категорию" style="display:none;">
</div>

<script>
    const categories = {{ categories|safe }}; // Преобразуйте данные категорий в JavaScript

    function updateCategories() {
        const type = document.getElementById('transaction-type').value;
        const categorySelect = document.getElementById('category');

        // Очистка предыдущих опций
        categorySelect.innerHTML = '<option value="">Выберите категорию</option>';

        // Добавление категорий в зависимости от типа
        categories.forEach(cat => {
            if (cat.type === type) {
                const option = document.createElement('option');
                option.value = cat.name;
                option.textContent = cat.name;
                categorySelect.appendChild(option);
            }
        });

        // Добавление опции для ввода собственной категории
        const customOption = document.createElement('option');
        customOption.value = 'custom';
        customOption.textContent = 'Другая категория';
        categorySelect.appendChild(customOption);
    }

    function handleCustomCategory() {
        const categorySelect = document.getElementById('category');
        const customCategoryInput = document.getElementById('custom-category');
        if (categorySelect.value === 'custom') {
            customCategoryInput.style.display = 'block';
        } else {
            customCategoryInput.style.display = 'none';
        }
    }
</script>

        <div class="form-group">
            <label for="amount">Сумма:</label>
            <input type="number" id="amount" name="amount" step="0.01" min="0" required>
        </div>

        <div class="form-group">
            <label for="description">Описание:</label>
            <textarea id="description" name="description" maxlength="300"></textarea>
        </div>

        <button type="submit">Добавить транзакцию</button>
    </form>
</div>

<script>
    // Инициализация категорий при загрузке страницы
    document.addEventListener('DOMContentLoaded', () => {
        updateCategories();
    });
</script>
</main>
{% endblock %}